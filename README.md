# Телеграм бот и REST API для получения данных о погоде
* В качестве внешнего API для получения данных о погоде используется openweathermap.org.
* Бот реализуется с использованием aiogram.
* Запросы к боту логгируются в БД.
* В качестве БД используется SQLite.
* Для просмотра логов запросов реализован REST API.
* Для реализации REST API используется fastapi.
* В REST API реализована Постраничная навигация и фильтрация логов по ID пользователя и по дате запроса.
* Постраничная навигация и фильтрация записей в базе для логов реализована на уровне БД, в виде запросов SQL.
* Глобальные данные для работы всех API вынесены в файл конфигурации в формате yaml.

Для запуска телеграм бота нужно вызвать метод start_bot() из файла bot.py. При первом запуске бота создаётся БД и таблица для логгирования. Бот содержит три основных обработчика сообщений пользователя:
* Команды /start и /help. Обе команды возвращают пользователю описание возможностей бота.
* Команда /weather название_города. Название города должно вводится на русском языке. Команда в зависимости от введённого названия города и доступности API вернёт либо сообщение с данными о погоде в запрошенном городе, либо сообщение об ошибке при получении данных.
* Любое сообщение отличное от указанных выше команд вернёт пользователю сообщение об отсутствии введённой команды, с указанием на команду /help, для получения рекомендаций по использованию бота.

REST API содержит один метод для получения списка логов - GET /logs. Метод включает в себя параметры для фильтрации по дате или ID пользователя и для возможностей постраничной навигации. Также метод содержит обработку неверных значений введённых пользователем, при этом возвращается сообщение с указанием ошибочного значения и код 400. Для запуска API можно использовать, например, сервер приложений uvicorn, при помощи следующей команды:

nohup uvicorn rest_api:app --reload &

Ниже представлено описание метода возвращающего логи.

### /logs

#### Тип метода GET

##### Описание:

Возвращает список отобранных по фильтрам записей в таблице с логами, а также параметры для постраничной навигации.

##### Параметры

| Название | Описание | Формат | Обязательный | Тип |
| -------- | -------- | ------ | ------------ | --- |
| user_id | ID пользователя для фильтрации | Целое число больше или равное 0 | Нет | целочисленный |
| page | Номер страницы с данными для получения из БД | Целое число больше 0 | Нет | целочисленный |
| page_size | Количество записей на странице | Целое число больше 0 | Нет | целочисленный |
| date_from | Нижняя граница для фильтрации по дате (date >= date_from) | ГГГГ-ММ-ДД чч:мм:сс | Нет | строка |
| date_to | Верхняя граница для фильтрации по дате (date <= date_to) | ГГГГ-ММ-ДД чч:мм:сс | Нет | строка |

##### Возвращаемые значения

| Название | Описание | Формат | Тип |
| -------- | -------- | ------ | --- |
| logs | Массив со списком логов для отображения на выбранной странице с заданными фильтрами | [{"user_id":\*,"user_text":"\*","utc_date":"\*","bot_text":"\*"}, ...] | Массив |
| page | Номер страницы для отображения данных | Целое число больше 0 | целочисленный |
| page_size | Количество записей на странице | Целое число больше 0 | целочисленный |
| record_count | Общее количество записей, которые можно отобрать с заданными фильтрами | Целое число больше или равное 0 | целочисленный |
| page_count | Общее количество страниц, которые можно отобразить с заданными фильтрами | Целое число больше или равное 0 | целочисленный |
